"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateCommonMenus = exports.validateKeyBounds = exports.validateLayouts = void 0;
var common_menus_1 = require("./common-menus");
var kle_parser_1 = require("./kle-parser");
var validateLayouts = function (layouts) {
    var _a = layouts.labels, labels = _a === void 0 ? [] : _a, keymap = layouts.keymap;
    var viaLayout = (0, kle_parser_1.kleLayoutToVIALayout)(keymap);
    var missingLabels = labels.filter(function (_, idx) {
        return viaLayout.optionKeys[idx] === undefined ||
            viaLayout.optionKeys[idx][0] === undefined;
    });
    if (missingLabels.length > 0) {
        throw new Error("The KLE is missing the group keys for: ".concat(missingLabels.join(',')));
    }
    return viaLayout;
};
exports.validateLayouts = validateLayouts;
var validateKeyBounds = function (matrix, layouts) {
    var rows = matrix.rows, cols = matrix.cols;
    var optionKeys = Object.values(layouts.optionKeys).flatMap(function (group) {
        return Object.values(group).flat();
    });
    var oobKeys = layouts.keys
        .concat(optionKeys)
        .filter(function (_a) {
        var row = _a.row, col = _a.col;
        return row >= rows || col >= cols;
    });
    if (oobKeys.length !== 0) {
        throw new Error("The following keys reference a row or column outside of dimension defined in the matrix property: ".concat(oobKeys
            .map(function (_a) {
            var row = _a.row, col = _a.col;
            return "(".concat(row, ",").concat(col, ")");
        })
            .join(',')));
    }
};
exports.validateKeyBounds = validateKeyBounds;
var validateCommonMenus = function (menus) {
    var lookupFailedKeys = (menus || []).filter(function (menu) {
        if (typeof menu === 'string') {
            return !Object.keys(common_menus_1.commonMenus).includes(menu);
        }
        return false;
    });
    if (lookupFailedKeys.length) {
        throw Error("Common menus not for found for: ".concat(lookupFailedKeys.join(', ')));
    }
};
exports.validateCommonMenus = validateCommonMenus;
